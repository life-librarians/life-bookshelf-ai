import os
from langchain_core.prompts import PromptTemplate
from operator import itemgetter
import pandas as pd

initial_prompt = PromptTemplate.from_template(
    """
당신은 사용자의 자서전을 돕는 AI입니다.
사용자가 첫 대답을 주면, 해당 대답을 기반으로 적합한 '주제'와 '소주제'를 선택하세요.

사용자가 말한 첫 대답:
"{answer}"

다음은 선택 가능한 주제/소주제 리스트입니다:
- 성장과정: 출생, 첫 독립, 첫 실패, 부모와의 거리감
- 가족관계: 부모, 형제자매, 자녀, 조부모, 반려동물, 배우자
- 학창시절: 학교 생활, 친구 관계, 과목 수업, 동아리 활동
- 직업/진로: 진로 선택 계기, 업무 에피소드, 대외활동, 번아웃 경험
- 가치관/성격: 성격 변화, 신념 형성 계기, 철학적 사고, 인생의 전환점
- 인생 경험: 어려움 극복 순간, 꿈의 좌절, 꿈의 변화, 인생의 터닝포인트
- 감정/취향: 좋아하는 것, 두려운 것, 몰입 경험, 감탄한 순간, 나만의 위로방식
- 사회/문화: 여행 경험, 세대 간 갈등, 종교 참여, 사회적 사건
- 기타: 돈, 철학, 뉴스/기사, 유행/사회 트렌드에 대한 생각

조건:
- 위 리스트에서 가장 적합한 주제/소주제를 하나 선택하세요.
- 그 이유는 간단히 설명하세요.

응답은 JSON 형식으로 출력하세요:
```json
{{
  "question": "다음에 물어볼 인터뷰 질문",
  "topic": "선택한 주제",
  "subtopic": "선택한 소주제",
  "reason": "선택 이유",
  "is_next": true,
  "is_over": false
}}
"""
)

followup_prompt = PromptTemplate.from_template(
    """당신은 사용자의 자서전을 돕는 인터뷰 질문 생성 AI입니다.

다음은 사용자의 최근 답변입니다:
"{answer}"

관련 참고 문서 (RAG 검색 결과):
{context}

위의 정보를 바탕으로, 사용자의 최근 답변에 자연스럽게 이어지는 호응 한마디를 먼저 작성하고, 이어서 자서전을 더욱 풍부하게 만들 수 있는 다음 인터뷰 질문 하나를 생성해주세요.

**조건:**
- 사용자의 이전 답변과 중복되지 않은 새로운 질문
- 감정, 동기, 배경, 맥락을 자연스럽게 회상하게 할 것
- 대화 흐름에 자연스럽게 연결될 것
- 호응과 다음 질문 모두 출력할 것

응답은 아래 JSON 형식으로 출력해주세요:
```json
{{
  "response": "자연스러운 호응 한마디",
  "question": "생성된 다음 인터뷰 질문",
  "is_next": true,
  "is_over": false
}}
"""
)